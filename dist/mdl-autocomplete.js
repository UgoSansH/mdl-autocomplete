!function(){"use strict";"undefined"==typeof Ugosansh&&(window.Ugosansh={}),"undefined"==typeof Ugosansh.Autocomplete&&(Ugosansh.Autocomplete={}),Ugosansh.Autocomplete.Component=function(inputElement,configs){if(this.container=null,this.input=null,this.listElement=null,this.onSearch=!1,this.pending=null,this.entities=new Array,this.listeners=new Array,this.hasSecondary=!1,this.preselected=null,this.config={path:"/search",query:"search",headers:{},minchar:2,avatar_size:34},configs)for(var key in configs)this.config.hasOwnProperty(key)&&(this.config[key]=configs[key]);if("string"==typeof inputElement&&(this.input=document.querySelector(inputElement)),!this.input)throw"Not found search input";this.renderComponent(),this.bind()},Ugosansh.Autocomplete.Component.prototype.CssClasses_={CONTAINER:"mdl-autocomplete",LIST:"mdl-autocomplete__list",ITEM:"mdl-autocomplete__item",PRIMARY:"mdl-autocomplete__item--primary",CONTENT:"mdl-autocomplete__item--content",SECONDARY:"mdl-autocomplete__item--secondary",AVATAR:"mdl-autocomplete__item--avatar",IS_VISIBLE:"is-visible",IS_SELECTED:"is-selected"},Ugosansh.Autocomplete.Component.prototype.bind=function(){document.addEventListener("keydown",this.onKeyboard.bind(this)),document.addEventListener("click",this.onDocument.bind(this)),this.input.addEventListener("keyup",this.onSearchChange.bind(this))},Ugosansh.Autocomplete.Component.prototype.bindItem=function(item){item.addEventListener("click",this.onSelectItem.bind(this))},Ugosansh.Autocomplete.Component.prototype.getUrl=function(search){return this.config.path+"?"+this.config.query+"="+search},Ugosansh.Autocomplete.Component.prototype.onChange=function(listener){this.listeners.push(listener)},Ugosansh.Autocomplete.Component.prototype.emit=function(entity){for(var i=0;i<this.listeners.length;i++){var listener=this.listeners[i];listener(entity)}},Ugosansh.Autocomplete.Component.prototype.onSearchChange=function(event){var search=this.input.value;if(this.preselected=0,this.updateSelected(),search.length>=this.config.minchar){var self=this,url=this.getUrl(search),request=new Ugosansh.Autocomplete.Request;request.get(url,this.config.headers).then(function(response){var items=response.json();items.length?(self.refreshList(items),self.open()):self.close()}).catch(function(response){console.error(response)})}else this.close()},Ugosansh.Autocomplete.Component.prototype.onKeyboard=function(event){var keyCode=event.keyCode;this.isOpen()&&(40==keyCode?this.onArrowDown(event):38==keyCode?this.onArrowUp(event):13==keyCode&&this.onEnter(event))},Ugosansh.Autocomplete.Component.prototype.onDocument=function(event){event.target.isOutside(this.container)&&event.target.isOutside(this.listElement)&&this.close()},Ugosansh.Autocomplete.Component.prototype.selectItem=function(item){var entity=this.find(item.dataset.id);entity&&(this.input.value=entity.name,this.close(),this.emit(entity))},Ugosansh.Autocomplete.Component.prototype.onSelectItem=function(event){var item=event.target;item.classList.contains(this.CssClasses_.ITEM)||(item=item.parents("."+this.CssClasses_.ITEM)),this.selectItem(item)},Ugosansh.Autocomplete.Component.prototype.updateSelected=function(){var selected=this.listElement.querySelector("."+this.CssClasses_.ITEM+"."+this.CssClasses_.IS_SELECTED);if(selected&&selected.classList.remove(this.CssClasses_.IS_SELECTED),this.preselected){var item=this.listElement.querySelector("."+this.CssClasses_.ITEM+'[data-key="'+this.preselected+'"]');item&&(this.input.blur(),item.focus(),item.classList.add(this.CssClasses_.IS_SELECTED))}},Ugosansh.Autocomplete.Component.prototype.onArrowUp=function(event){this.preselected?this.preselected>1&&this.preselected--:this.preselected=1,this.updateSelected()},Ugosansh.Autocomplete.Component.prototype.onArrowDown=function(event){if(this.preselected){var length=this.listElement.querySelectorAll("."+this.CssClasses_.ITEM).length;this.preselected<length&&this.preselected++}else this.preselected=1;this.updateSelected()},Ugosansh.Autocomplete.Component.prototype.onEnter=function(event){if(this.isOpen()){if(this.preselected){var item=this.listElement.querySelector("."+this.CssClasses_.ITEM+'[data-key="'+this.preselected+'"]');item&&this.selectItem(item)}event.preventDefault()}},Ugosansh.Autocomplete.Component.prototype.open=function(event){this.listElement.classList.add(this.CssClasses_.IS_VISIBLE)},Ugosansh.Autocomplete.Component.prototype.close=function(event){this.clearList(),this.listElement.classList.remove(this.CssClasses_.IS_VISIBLE)},Ugosansh.Autocomplete.Component.prototype.isOpen=function(){return this.listElement.classList.contains(this.CssClasses_.IS_VISIBLE)},Ugosansh.Autocomplete.Component.prototype.renderComponent=function(){this.container||(this.container=this.input.parentNode,this.container.classList.contains(this.CssClasses_.CONTAINER)||this.container.classList.add(this.CssClasses_.CONTAINER)),this.renderList()},Ugosansh.Autocomplete.Component.prototype.renderList=function(){this.listElement||(this.listElement=document.createElement("div"),this.listElement.classList.add(this.CssClasses_.LIST),this.container.appendChild(this.listElement))},Ugosansh.Autocomplete.Component.prototype.refreshList=function(entities){this.clearList(),this.configureList(entities),this.entities=entities;for(var i=0;i<entities.length;i++){var item=this.renderItem(entities[i],i+1);this.listElement.appendChild(item),this.bindItem(item)}},Ugosansh.Autocomplete.Component.prototype.configureList=function(entities){this.hasSecondary=!1;for(var i=0;i<entities.length;i++)this.hasSecondary||"undefined"!=typeof entities[i].image&&(this.hasSecondary=!0)},Ugosansh.Autocomplete.Component.prototype.clearList=function(){for(;this.listElement.hasChildNodes();)this.listElement.removeChild(this.listElement.lastChild)},Ugosansh.Autocomplete.Component.prototype.renderItem=function(entity,key){var item=document.createElement("div"),primary=document.createElement("div"),title=document.createElement("div");if(item.classList.add(this.CssClasses_.ITEM),primary.classList.add(this.CssClasses_.PRIMARY),title.classList.add(this.CssClasses_.TITLE),item.dataset.key=key,item.dataset.id=entity.id,title.appendChild(document.createTextNode(entity.name)),primary.appendChild(title),"undefined"!=typeof entity.content){var content=document.createElement("div");content.classList.add(this.CssClasses_.CONTENT),content.innerHTML=entity.content,primary.appendChild(content)}if("undefined"!=typeof entity.image){this.hasSecondary=!0;var secondary=document.createElement("div"),avatar=document.createElement("img");secondary.classList.add(this.CssClasses_.SECONDARY),avatar.classList.add(this.CssClasses_.AVATAR),avatar.src=entity.image,avatar.alt=entity.name,avatar.width=this.config.avatar_size,avatar.height=this.config.avatar_size,secondary.appendChild(avatar),item.appendChild(secondary)}else if(this.hasSecondary){var secondary=document.createElement("div");secondary.classList.add(this.CssClasses_.SECONDARY),secondary.style.width=""+this.config.avatar_size+"px",item.appendChild(secondary)}return item.appendChild(primary),item},Ugosansh.Autocomplete.Component.prototype.find=function(id){for(var i=0;i<this.entities.length;i++)if(this.entities[i].id==id)return this.entities[i];return null}}(),function(){"use strict";"undefined"==typeof Ugosansh&&(window.Ugosansh={}),"undefined"==typeof Ugosansh.Autocomplete&&(Ugosansh.Autocomplete={}),Ugosansh.Autocomplete.Request=function(headers){this.headers=headers||new Map},Ugosansh.Autocomplete.Request.prototype.createXhr=function(){var xhr;if(!window.XMLHttpRequest&&!window.ActiveXObject)throw"Your browser doesn't support XMLHTTPRequest";if(window.ActiveXObject)try{xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){xhr=new ActiveXObject("Microsoft.XMLHTTP")}else xhr=new XMLHttpRequest;return xhr},Ugosansh.Autocomplete.Request.prototype.send=function(method,url,headers,body){var self=this,promise=new Promise(function(resolve,reject){var xhr=self.createXhr(),contentType=null;if(xhr.onprogress=function(event){document.dispatchEvent(new CustomEvent("xhr_request_progress",{detail:{event:event,request:self}}))},xhr.onloadstart=function(event){document.dispatchEvent(new CustomEvent("xhr_request_start",{detail:{event:event,request:self}}))},xhr.onerror=function(event){document.dispatchEvent(new CustomEvent("xhr_request_error",{detail:{event:event,request:self}})),reject({event:event,request:self})},xhr.onreadystatechange=function(){if(4==xhr.readyState){var response=new Ugosansh.Autocomplete.Response(xhr.responseText?xhr.responseText:xhr.responseXML,xhr.responseURL,xhr.status,xhr.statusText,xhr.getResponseHeader("Content-Type"));document.dispatchEvent(new CustomEvent("xhr_request_end",{detail:response})),resolve(response)}},xhr.open(method,url,!0),self.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)}),headers)for(var i in headers)"Content-Type"==i&&(contentType=headers[i]),xhr.setRequestHeader(i,headers[i]);if(["POST","PUT","PATCH"].indexOf(method)>-1&&body){var data="";"object"==typeof body&&"FormData"!=body.constructor.name&&("application/json"==contentType?data=JSON.stringify(body):(xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),data=self.serializeFormData(body),data=data.substring(0,data.length-1)),body=data)}xhr.send(body)});return promise},Ugosansh.Autocomplete.Request.prototype.serializeFormData=function(data,key){var response="";for(var i in data)data.hasOwnProperty(i)&&(response+="object"==typeof data[i]?key?this.serializeFormData(data[i],key+"["+i+"]"):this.serializeFormData(data[i],i):key?key+"["+i+"]="+encodeURIComponent(data[i])+"&":i+"="+encodeURIComponent(data[i])+"&");return response},Ugosansh.Autocomplete.Request.prototype.get=function(url,headers){return this.send("GET",url,headers)},Ugosansh.Autocomplete.Request.prototype.post=function(url,body,headers){return this.send("POST",url,headers,body)},Ugosansh.Autocomplete.Request.prototype.put=function(url,body,headers){return this.send("PUT",url,headers,body)},Ugosansh.Autocomplete.Request.prototype.patch=function(url,body,headers){return this.send("PATCH",url,headers,body)},Ugosansh.Autocomplete.Request.prototype.delete=function(url,body,headers){return this.send("DELETE",url,headers,body)},Ugosansh.Autocomplete.Request.prototype.head=function(url,body,headers){return this.send("HEAD",url,headers,body)},Ugosansh.Autocomplete.Request.prototype.options=function(url,body,headers){return this.send("OPTIONS",url,headers,body)},Ugosansh.Autocomplete.Response=function(content,request,status,statusText,contentType){this.content=content||"",this.request=request||null,this.status=status||200,this.statusText=statusText||"Ok",this.contentType=contentType||"text/plain"},Ugosansh.Autocomplete.Response.prototype.getRequest=function(){return this.request},Ugosansh.Autocomplete.Response.prototype.text=function(){return this.content},Ugosansh.Autocomplete.Response.prototype.json=function(){return JSON.parse(this.content)},Ugosansh.Autocomplete.Response.prototype.getStatus=function(){return this.status},Ugosansh.Autocomplete.Response.prototype.getStatusText=function(){return this.statusText},Ugosansh.Autocomplete.Response.prototype.getContentType=function(){return this.contentType},Ugosansh.Autocomplete.Response.prototype.hasError=function(){return this.status<200||this.status>=400}}(),function(){"use strict";Element.prototype.parents||(Element.prototype.parents=function(selector){if(this.matches){if(this.matches(selector))return this;for(var target=this.parentNode;target&&target!=this;target=target.parentNode)if(target.matches(selector))return target}return null}),Element.prototype.isOutside||(Element.prototype.isOutside=function(element){if(this==element)return!1;for(var target=this.parentNode;target&&target!=this;target=target.parentNode)if(target==element)return!1;return!0})}();
//# sourceMappingURL=mdl-autocomplete.map